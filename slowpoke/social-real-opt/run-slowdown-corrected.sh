# cd $(dirname $0)

# # 4000000 / (3,158.2869254324 * 0.7005428505) = 1,807.8970816646

# # baseline_throughput = 1,500.08378436712 * 0.7005428505
# # baseline_processing_time = 2000000 / 1,050.8729702894 = 1,903.1796007173
# # d = 1,903.1796007173 / 2 = 951.5898003586
# # "composepost": 0.09979209979,
# #  "hometimeline": 0.7005428505,
# #  "poststorage": 0.9497747748,
# #  "socialgraph": 0.099792099790,
# #  "usertimeline": 0.4022002772

# # delay = d * ratio[target] * cpu[service] / (ratio[service] * cpu[target])
# # actual_delay = delay / cpu[service] = d * ratio[target] / (ratio[service] * cpu[target])
# # compose = 951.5898003586 * 0.7005428505 / (0.09979209979 * 2 ) = 3,340.0912128955
# # poststorage = 951.5898003586 * 0.7005428505 / (0.9497747748 * 2 ) = 350.9407961431
# # socialgraph = 951.5898003586 * 0.7005428505 / (0.099792099790 * 2 ) = 3,340.0912128955
# # usertimeline = 951.5898003586 * 0.7005428505 / (0.4022002772 * 2 ) = 828.728209601

# # predicted = 1000000/ ( 1000000 / 1,506.6563418019 - (951.5898003586 * 0.7005428505 / 2) ) = 3,026.5734949887



# # export SLOWPOKE_PROCESSING_MICROS_COMPOSEPOST=0
# # export SLOWPOKE_PROCESSING_MICROS_HOMETIMELINE=1000
# # export SLOWPOKE_PROCESSING_MICROS_POSTSTORAGE=0
# # export SLOWPOKE_PROCESSING_MICROS_SOCIALGRAPH=0
# # export SLOWPOKE_PROCESSING_MICROS_USERTIMELINE=0

# # export SLOWPOKE_DELAY_MICROS_COMPOSEPOST=3340.0912128955
# # export SLOWPOKE_DELAY_MICROS_POSTSTORAGE=350.9407961431
# # export SLOWPOKE_DELAY_MICROS_SOCIALGRAPH=3340.0912128955
# # export SLOWPOKE_DELAY_MICROS_USERTIMELINE=828.728209601
# # export SLOWPOKE_DELAY_MICROS_HOMETIMELINE=0.0

# # export SLOWPOKE_POKER_BATCH_THRESHOLD_COMPOSEPOST=100
# # export SLOWPOKE_IS_TARGET_SERVICE_COMPOSEPOST=false
# # export SLOWPOKE_POKER_BATCH_THRESHOLD_HOMETIMELINE=100
# # export SLOWPOKE_IS_TARGET_SERVICE_HOMETIMELINE=true
# # export SLOWPOKE_POKER_BATCH_THRESHOLD_POSTSTORAGE=100
# # export SLOWPOKE_IS_TARGET_SERVICE_POSTSTORAGE=false
# # export SLOWPOKE_POKER_BATCH_THRESHOLD_SOCIALGRAPH=100
# # export SLOWPOKE_IS_TARGET_SERVICE_SOCIALGRAPH=false
# # export SLOWPOKE_POKER_BATCH_THRESHOLD_USERTIMELINE=100
# # export SLOWPOKE_IS_TARGET_SERVICE_USERTIMELINE=false

# DIR=/home/ubuntu/mucache/slowpoke/social-real-opt/results
# FILE=slowdown-1.log
# if [ ! -d "$DIR" ]; then
#   mkdir -p $DIR
# fi
# if [ -f "$DIR/$FILE" ]; then
#   echo "$DIR/$FILE exists."
#   exit 0
# fi
# env | grep SLOWPOKE > $DIR/$FILE
# bash /home/ubuntu/mucache/slowpoke/run.sh social mix 8 1024 20000 > $DIR/$FILE


cd $(dirname $0)

# export SLOWPOKE_PROCESSING_MICROS_COMPOSEPOST=0
# export SLOWPOKE_PROCESSING_MICROS_HOMETIMELINE=1000
# export SLOWPOKE_PROCESSING_MICROS_POSTSTORAGE=0
# export SLOWPOKE_PROCESSING_MICROS_SOCIALGRAPH=0
# export SLOWPOKE_PROCESSING_MICROS_USERTIMELINE=0
# export SLOWPOKE_DELAY_MICROS_COMPOSEPOST=0.0
# export SLOWPOKE_POKER_BATCH_THRESHOLD_COMPOSEPOST=100
# export SLOWPOKE_IS_TARGET_SERVICE_COMPOSEPOST=false
# export SLOWPOKE_DELAY_MICROS_HOMETIMELINE=0.0
# export SLOWPOKE_POKER_BATCH_THRESHOLD_HOMETIMELINE=100
# export SLOWPOKE_IS_TARGET_SERVICE_HOMETIMELINE=true
# export SLOWPOKE_DELAY_MICROS_POSTSTORAGE=0.0
# export SLOWPOKE_POKER_BATCH_THRESHOLD_POSTSTORAGE=100
# export SLOWPOKE_IS_TARGET_SERVICE_POSTSTORAGE=false
# export SLOWPOKE_DELAY_MICROS_SOCIALGRAPH=0.0
# export SLOWPOKE_POKER_BATCH_THRESHOLD_SOCIALGRAPH=100
# export SLOWPOKE_IS_TARGET_SERVICE_SOCIALGRAPH=false
# export SLOWPOKE_DELAY_MICROS_USERTIMELINE=0.0
# export SLOWPOKE_POKER_BATCH_THRESHOLD_USERTIMELINE=100
# export SLOWPOKE_IS_TARGET_SERVICE_USERTIMELINE=false

DIR=/home/ubuntu/mucache/slowpoke/social-real-opt/results
for i in $(seq 6 10); do
    FILE=slowdown-corrected-$i.log
    if [ ! -d "$DIR" ]; then
    mkdir -p $DIR
    fi
    if [ -f "$DIR/$FILE" ]; then
    echo "$DIR/$FILE exists."
    exit 0
    fi
    source <(python3 env.py baseline-$i.log premesaurement-$i.log)
    env | grep SLOWPOKE > $DIR/$FILE
    bash /home/ubuntu/mucache/slowpoke/run.sh social mix 8 1024 20000 >> $DIR/$FILE
done