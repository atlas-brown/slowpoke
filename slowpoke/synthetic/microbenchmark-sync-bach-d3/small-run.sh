#!/bin/bash

cd $(dirname $0)


export SLOWPOKE_POKER_BATCH_THRESHOLD=10000000
export PROCESSING_TIME_SERVICE0=0.003 # base
export PROCESSING_TIME_SERVICE1=0.001 # base
export PROCESSING_TIME_SERVICE2=0.002 # base
export PROCESSING_TIME_SERVICE3=0.004 # base

export SLOWPOKE_DELAY_MICROS_SERVICE0=0
export SLOWPOKE_DELAY_MICROS_SERVICE1=0
export SLOWPOKE_DELAY_MICROS_SERVICE2=0
export SLOWPOKE_DELAY_MICROS_SERVICE3=0
export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE0=50000000
export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE1=90000000
export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE2=70000000
export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE3=30000000

# export SLOWPOKE_DELAY_MICROS_SERVICE0=500
# export SLOWPOKE_DELAY_MICROS_SERVICE1=900
# export SLOWPOKE_DELAY_MICROS_SERVICE2=700
# export SLOWPOKE_DELAY_MICROS_SERVICE3=300
# export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE0=50000000
# export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE1=90000000
# export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE2=70000000
# export SLOWPOKE_POKER_BATCH_THRESHOLD_SERVICE3=30000000

DIR=/home/ubuntu/mucache/slowpoke/synthetic/microbenchmark-sync-bach-d3/yamls
for file in $(ls -d $DIR/*.yaml)
do
    envsubst < $file | kubectl delete -f - 
    envsubst < $file | kubectl apply -f - 
done
