benchmark                        : movie
num_threads                      : 8
num_conns                        : 800
target_service                   : moviereviews
request_type                     : mix
repetitions                      : 3
target_num_exp                   : 2
pre_run                          : False
num_req                          : 50000
groundtruths                     : []
slowdowns                        : []
predicteds                       : []
errs                             : []
client_cpu_quota                 : 4
random_seed                      : 1234
request_ratio                    : {'castinfo': 0.9050900514, 'composereview': 0.1003336848, 'frontend': 0.1003336848, 'movieid': 0.1003336848, 'movieinfo': 0.9050900514, 'moviereviews': 0.9050900514, 'page': 0.9050900514, 'plot': 0.9050900514, 'reviewstorage': 1.005423736183, 'uniqueid': 0.1003336848, 'user': 0.2006673695, 'userreviews': 0.1003336848}
baseline_service_processing_time : {'castinfo': 0, 'composereview': 0, 'frontend': 0, 'movieid': 0, 'movieinfo': 0, 'moviereviews': 1000, 'page': 0, 'plot': 0, 'reviewstorage': 0, 'uniqueid': 0, 'user': 0, 'userreviews': 0}
cpu_quota                        : {'castinfo': 2, 'composereview': 2, 'frontend': 2, 'movieid': 2, 'movieinfo': 2, 'moviereviews': 2, 'page': 2, 'plot': 2, 'reviewstorage': 2, 'uniqueid': 2, 'user': 2, 'userreviews': 2}
target_processing_time_range     : [0, 1000]
baseline_throughputs             : []
poker_batch                      : 60000000
[test.py] Starting experiment...
[test.py] >>>>>>>>>>>>>>>>>>>>>>>>>>>>> Running experiment 0...
[test.py] Actual processing time range: [0, 500]
[test.py] Running baseline experiment
    [exp] Running (pre_run: False) workload movie/mix request with the following configuration: {'CLIENT_CPU_QUOTA': '4', 'SLOWPOKE_POKER_BATCH_THRESHOLD': '60000000', 'SLOWPOKE_PROCESSING_MICROS_CASTINFO': '0', 'SLOWPOKE_PROCESSING_MICROS_COMPOSEREVIEW': '0', 'SLOWPOKE_PROCESSING_MICROS_FRONTEND': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEID': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEINFO': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEREVIEWS': '1000', 'SLOWPOKE_PROCESSING_MICROS_PAGE': '0', 'SLOWPOKE_PROCESSING_MICROS_PLOT': '0', 'SLOWPOKE_PROCESSING_MICROS_REVIEWSTORAGE': '0', 'SLOWPOKE_PROCESSING_MICROS_UNIQUEID': '0', 'SLOWPOKE_PROCESSING_MICROS_USER': '0', 'SLOWPOKE_PROCESSING_MICROS_USERREVIEWS': '0', 'SLOWPOKE_DELAY_MICROS_CASTINFO': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_CASTINFO': '10', 'SLOWPOKE_DELAY_MICROS_COMPOSEREVIEW': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_COMPOSEREVIEW': '10', 'SLOWPOKE_DELAY_MICROS_FRONTEND': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_FRONTEND': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEID': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEID': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEINFO': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEINFO': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEREVIEWS': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEREVIEWS': '10', 'SLOWPOKE_DELAY_MICROS_PAGE': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_PAGE': '10', 'SLOWPOKE_DELAY_MICROS_PLOT': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_PLOT': '10', 'SLOWPOKE_DELAY_MICROS_REVIEWSTORAGE': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_REVIEWSTORAGE': '10', 'SLOWPOKE_DELAY_MICROS_UNIQUEID': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_UNIQUEID': '10', 'SLOWPOKE_DELAY_MICROS_USER': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_USER': '10', 'SLOWPOKE_DELAY_MICROS_USERREVIEWS': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_USERREVIEWS': '10'}
    [exp] Executing cmd `bash run.sh movie mix 8 800 50000`:
        [run.sh] Running benchmark movie with request mix, thread 8, conn 800, duration 60
        [run.sh] Deleting all services
        service "castinfo" deleted
        deployment.apps "castinfo" deleted
        service "composereview" deleted
        deployment.apps "composereview" deleted
        service "frontend" deleted
        deployment.apps "frontend" deleted
        service "movieid" deleted
        deployment.apps "movieid" deleted
        service "movieinfo" deleted
        deployment.apps "movieinfo" deleted
        service "moviereviews" deleted
        deployment.apps "moviereviews" deleted
        service "page" deleted
        deployment.apps "page" deleted
        service "plot" deleted
        deployment.apps "plot" deleted
        service "reviewstorage" deleted
        deployment.apps "reviewstorage" deleted
        service "uniqueid" deleted
        deployment.apps "uniqueid" deleted
        service "user" deleted
        deployment.apps "user" deleted
        service "userreviews" deleted
        deployment.apps "userreviews" deleted
        deployment.apps "ubuntu-client" deleted
        [run.sh] Waiting for all pods to be deleted
        [run.sh] Deploying all services
        service/castinfo created
        deployment.apps/castinfo created
        service/composereview created
        deployment.apps/composereview created
        service/frontend created
        deployment.apps/frontend created
        service/movieid created
        deployment.apps/movieid created
        service/movieinfo created
        deployment.apps/movieinfo created
        service/moviereviews created
        deployment.apps/moviereviews created
        service/page created
        deployment.apps/page created
        service/plot created
        deployment.apps/plot created
        service/reviewstorage created
        deployment.apps/reviewstorage created
        service/uniqueid created
        deployment.apps/uniqueid created
        service/user created
        deployment.apps/user created
        service/userreviews created
        deployment.apps/userreviews created
        [run.sh] Client pod not found, deploying client
        deployment.apps/ubuntu-client created
        [run.sh] Waiting for all pods to be running
        [run.sh] All pods are running
        [run.sh] Checking heartbeat for all services
        [run.sh] All pods can connect to all services
        [run.sh] Copying movie/analysis.txt to ubuntu-client-76886f6bbd-266v7:/analysis.txt
        [run.sh] Finished populating movie
        [run.sh] Starting the rust proxy first for movie
        [2m2025-04-07T04:10:06.057085Z[0m [32m INFO[0m [2mproxy::movie[0m[2m:[0m Reading movie analysis data from /analysis.txt
        [run.sh] Running warmup test
        [run.sh] /wrk/wrk -t8 -c800 --timeout 3s -d3s -L http://localhost:3000
        Running 3s test @ http://localhost:3000
        8 threads and 800 connections
        Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency   742.57ms  336.09ms   1.57s    69.97%
        Req/Sec    92.48     47.02   290.00     65.74%
        Latency Distribution
        50%  735.18ms
        75%    1.03s
        90%    1.15s
        99%    1.39s
        2058 requests in 3.02s, 156.76KB read
        Requests/sec:    681.63
        Transfer/sec:     51.92KB
        [run.sh] Speed is 681.63, duration is 110
        [run.sh] Fix the request number.
        [run.sh] Running the actual test
        [run.sh] /wrk/wrk --timeout 20s -t8 -c800 -d110s -s /wrk/fix_req_n.lua -L http://localhost:3000
        [run.sh] Checking the resource usage
        NAME                             CPU(cores)   MEMORY(bytes)
        castinfo-56549f7689-spr7p        3m           59Mi
        composereview-676886854c-27fxn   32m          10Mi
        frontend-67bcc5d87b-99lsv        32m          10Mi
        movieid-6b7485b65-7q55h          3m           172Mi
        movieinfo-969fd9977-l5dm5        0m           202Mi
        moviereviews-7d747bcb8-sp62j     80m          21Mi
        page-6597cb4c54-n8w7p            429m         86Mi
        plot-5464fccfdd-7x5sj            0m           317Mi
        reviewstorage-86dd5ff9b9-kkd8v   9m           12Mi
        ubuntu-client-76886f6bbd-266v7   147m         81Mi
        uniqueid-5987bc8cf9-bsjjw        3m           7Mi
        user-6776c48774-q4cqz            13m          8Mi
        userreviews-5d99989bf-5chl8      3m           7Mi
        Running 2m test @ http://localhost:3000
        8 threads and 800 connections
        Thread Stats   Avg      Stdev     Max   +/- Stdev
        Latency     2.20s     2.26s   15.34s    83.63%
        Req/Sec   103.11     41.08   313.00     70.75%
        Latency Distribution
        50%    1.11s
        75%    3.00s
        90%    5.55s
        99%   10.08s
        49910 requests in 1.84m, 3.71MB read
        Requests/sec:    453.31
        Transfer/sec:     34.53KB
        ------------------------------
        stop time: 103.838145
        [run.sh] Test finished with status 1
        > STDERR
        > No resources found in default namespace.
        > PANIC: unprotected error in call to Lua API (/wrk/fix_req_n.lua:32: bad argument #1 to 'format' (number expected, got nil))
        > command terminated with exit code 1
    [exp] Error running bash run.sh movie mix 8 800 50000
[test.py] Found 0 throughput, rerun experiment
    [exp] Running (pre_run: False) workload movie/mix request with the following configuration: {'CLIENT_CPU_QUOTA': '4', 'SLOWPOKE_POKER_BATCH_THRESHOLD': '60000000', 'SLOWPOKE_PROCESSING_MICROS_CASTINFO': '0', 'SLOWPOKE_PROCESSING_MICROS_COMPOSEREVIEW': '0', 'SLOWPOKE_PROCESSING_MICROS_FRONTEND': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEID': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEINFO': '0', 'SLOWPOKE_PROCESSING_MICROS_MOVIEREVIEWS': '1000', 'SLOWPOKE_PROCESSING_MICROS_PAGE': '0', 'SLOWPOKE_PROCESSING_MICROS_PLOT': '0', 'SLOWPOKE_PROCESSING_MICROS_REVIEWSTORAGE': '0', 'SLOWPOKE_PROCESSING_MICROS_UNIQUEID': '0', 'SLOWPOKE_PROCESSING_MICROS_USER': '0', 'SLOWPOKE_PROCESSING_MICROS_USERREVIEWS': '0', 'SLOWPOKE_DELAY_MICROS_CASTINFO': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_CASTINFO': '10', 'SLOWPOKE_DELAY_MICROS_COMPOSEREVIEW': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_COMPOSEREVIEW': '10', 'SLOWPOKE_DELAY_MICROS_FRONTEND': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_FRONTEND': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEID': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEID': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEINFO': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEINFO': '10', 'SLOWPOKE_DELAY_MICROS_MOVIEREVIEWS': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_MOVIEREVIEWS': '10', 'SLOWPOKE_DELAY_MICROS_PAGE': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_PAGE': '10', 'SLOWPOKE_DELAY_MICROS_PLOT': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_PLOT': '10', 'SLOWPOKE_DELAY_MICROS_REVIEWSTORAGE': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_REVIEWSTORAGE': '10', 'SLOWPOKE_DELAY_MICROS_UNIQUEID': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_UNIQUEID': '10', 'SLOWPOKE_DELAY_MICROS_USER': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_USER': '10', 'SLOWPOKE_DELAY_MICROS_USERREVIEWS': '0.0', 'SLOWPOKE_POKER_BATCH_THRESHOLD_USERREVIEWS': '10'}
    [exp] Executing cmd `bash run.sh movie mix 8 800 50000`:
        [run.sh] Running benchmark movie with request mix, thread 8, conn 800, duration 60
        [run.sh] Deleting all services
        service "castinfo" deleted
        deployment.apps "castinfo" deleted
        service "composereview" deleted
        deployment.apps "composereview" deleted
        service "frontend" deleted
        deployment.apps "frontend" deleted
        service "movieid" deleted
        deployment.apps "movieid" deleted
        service "movieinfo" deleted
        deployment.apps "movieinfo" deleted
        service "moviereviews" deleted
        deployment.apps "moviereviews" deleted
        service "page" deleted
        deployment.apps "page" deleted
        service "plot" deleted
        deployment.apps "plot" deleted
        service "reviewstorage" deleted
        deployment.apps "reviewstorage" deleted
        service "uniqueid" deleted
        deployment.apps "uniqueid" deleted
        service "user" deleted
        deployment.apps "user" deleted
        service "userreviews" deleted
        deployment.apps "userreviews" deleted
        deployment.apps "ubuntu-client" deleted
        [run.sh] Waiting for all pods to be deleted
        [run.sh] Deploying all services
        service/castinfo created
        deployment.apps/castinfo created
        service/composereview created
        deployment.apps/composereview created
        service/frontend created
        deployment.apps/frontend created
        service/movieid created
        deployment.apps/movieid created
        service/movieinfo created
        deployment.apps/movieinfo created
        service/moviereviews created
        deployment.apps/moviereviews created
        service/page created
        deployment.apps/page created
        service/plot created
        deployment.apps/plot created
        service/reviewstorage created
        deployment.apps/reviewstorage created
        service/uniqueid created
        deployment.apps/uniqueid created
        service/user created
        deployment.apps/user created
        service/userreviews created
        deployment.apps/userreviews created
        [run.sh] Client pod not found, deploying client
        deployment.apps/ubuntu-client created
        [run.sh] Waiting for all pods to be running
        [run.sh] All pods are running
        [run.sh] Checking heartbeat for all services
        [run.sh] All pods can connect to all services
        [run.sh] Copying movie/analysis.txt to ubuntu-client-76886f6bbd-vjjhb:/analysis.txt
        [run.sh] Finished populating movie
